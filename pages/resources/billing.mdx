# Billing

todo i am lazy to make description for resouce

### Payment Source Object

###### Payment Source Structure

| Field                      | Type                                       | Description                                                                       |
| -------------------------- | ------------------------------------------ | --------------------------------------------------------------------------------- |
| id                         | snowflake                                  | The ID of the payment source                                                      |
| brand?                     | string                                     | The brand of the payment source (only applicable for credit cards)                |
| country?                   | string                                     | The country of the payment source                                                 |
| last_4?                    | string                                     | The last four digits of the payment source (only applicable for credit cards)     |
| billing_address ^1^        | [billing address](#billing-address-object) | The billing address of the payment source                                         |
| type                       | integer                                    | The [type of the payment source](#payment-source-type)                            |
| payment_gateway            | integer                                    | The [payment gateway](#payment-gateway) of the payment source                     |
| payment_gateway_source_id? | string                                     | The ID of the payment source in the payment gateway                               |
| default ^1^                | boolean                                    | Whether the payment source is the default payment source                          |
| invalid                    | boolean                                    | Whether the payment source is invalid                                             |
| flags                      | integer                                    | The [payment source's flags](#payment-source-flags)                               |
| deleted_at                 | ?ISO8601 timestamp                         | When the payment source was deleted at                                            |
| expires_month?             | integer                                    | The month the credit card expires in                                              |
| expires_year?              | integer                                    | The year the credit card expires in                                               |
| email?                     | string                                     | The email address associated with the payment source (only applicable for PayPal) |
| bank?                      | string                                     | The bank associated with the payment source                                       |
| username?                  | string                                     | The username associated with the payment source (only applicable for Venmo)       |

^1^ Not available in payment objects.

###### Example Payment Source

```json
 {
        "id": "1",
        "type": 1,
        "invalid": false,
        "flags": 0,
        "deleted_at": null,
        "brand": "visa",
        "last_4": "4242",
        "expires_month": 6,
        "expires_year": 2077,
        "billing_address": {
            "name": "Іван",
            "line_1": "вул. Хрещатик, 24",
            "line_2": null,
            "city": "Київ",
            "state": "State",
            "country": "UA",
            "postal_code": "46610"
        },
        "country": "UA",
        "payment_gateway": 1,
        "payment_gateway_source_id": "pm_DwiVlGlYwe1qxLzy4QWChQeo",
        "default": false
    }

```

### Billing Address Object

###### Billing Address Structure

| Field        | Type    | Description                                          |
| ------------ | ------- | ---------------------------------------------------- |
| line_1       | string  | The address of the location                          |
| line_2?      | ?string | The secondary address of the location                |
| name         | string  | The name of the payment source                       |
| postal_code? | string  | The postal code of the location                      |
| city         | string  | The city of the location                             |
| state?       | string  | The state or province of the location                |
| country      | string  | The country of the location                          |
| email?       | string  | The email address associated with the payment source |

###### Payment Source Type

| Value | Name            | Description        |
| ----- | --------------- | ------------------ |
| 0     | UNKNOWN         | Unknown            |
| 1     | CARD            | Credit card        |
| 2     | PAYPAL          | PayPal             |
| 3     | GIROPAY         | Giropay            |
| 4     | SOFORT          | Sofort             |
| 5     | PRZELEWY24      | Przelewy24         |
| 6     | SEPA_DEBIT      | SEPA debit         |
| 7     | PAYSAFE_CARD    | Paysafe            |
| 8     | GCASH           | GCash              |
| 9     | GRABPAY_MY      | GrabPay (Malaysia) |
| 10    | MOMO_WALLET     | MoMo Wallet        |
| 11    | VENMO           | Venmo              |
| 12    | GOPAY_WALLET    | GoPay Wallet       |
| 13    | KAKAOPAY        | KakaoPay           |
| 14    | BANCONTACT      | Bancontact         |
| 15    | EPS             | EPS                |
| 16    | IDEAL           | iDEAL              |
| 17    | CASH_APP        | Cash App           |
| 18    | APPLE           | Apple Pay          |
| 99    | PAYMENT_REQUEST | Unknown            |

###### Payment Gateway

| Value | Name          | Description |
| ----- | ------------- | ----------- |
| 1     | STRIPE        | Stripe      |
| 2     | BRAINTREE     | Braintree   |
| 3     | APPLE         | Apple       |
| 4     | GOOGLE        | Google      |
| 5     | ADYEN         | Adyen       |
| 6     | APPLE_PARTNER | Apple Pay   |

###### Payment Source Flags

| Value  | Name | Description           |
| ------ | ---- | --------------------- |
| 1 << 0 | NEW  | Payment source is new |

### Endpoints

<RouteHeader method="GET" url="/users/@me/billing/country-code" supportsOAuth2="payment_sources.country_code">
  Get Billing Country Code
</RouteHeader>

Returns user's country code based on requesting IP address.

###### Response Body

| Field        | Type   | Description      |
| ------------ | ------ | ---------------- |
| country_code | string | The country code |

<RouteHeader method="GET" url="/users/@me/billing/payment-sources">
  Get Payment Sources
</RouteHeader>

Returns a list of [payment source](#payment-source-object) objects.

<RouteHeader method="GET" url="/users/@me/billing/payment-sources/{payment_source.id}" mfa>
  Get Payment Source
</RouteHeader>

Returns a [payment source](#payment-source-object) object for a given payment source ID.

<RouteHeader method="POST" url="/users/@me/billing/payment-sources">
  Create Payment Source
</RouteHeader>

Creates a payment source. Returns a [payment source](#payment-source-object) object on success. Fires [User Payment Sources Update](/topics/gateway-events#user-payment-sources-update) Gateway event.

###### JSON Params

| Field                  | Type                                              | Description                                                                            |
| ---------------------- | ------------------------------------------------- | -------------------------------------------------------------------------------------- |
| token                  | string                                            | The token of payment source                                                            |
| payment_gateway        | integer                                           | The [payment gateway](#payment-gateway) of the payment source                          |
| billing_address        | [billing address](#billing-address-object) object | The billing address of the payment source                                              |
| billing_address_token? | string                                            | The token obtained from [Validate Billing Address](#validate-billing-address) endpoint |
| return_url?            | string                                            | The URL to return to after the payment source is created                               |
| bank?                  | string                                            | The bank information for the payment source                                            |

<RouteHeader method="POST" url="/users/@me/billing/payment-sources">
  Modify Payment Source
</RouteHeader>

Modifies a payment source. Returns an updated [payment source](#payment-source-object) object on success. Fires [User Payment Sources Update](/topics/gateway-events#user-payment-sources-update) Gateway event.

###### JSON Params

| Field            | Type                                              | Description                                              |
| ---------------- | ------------------------------------------------- | -------------------------------------------------------- |
| billing_address? | [billing address](#billing-address-object) object | The billing address of the payment source                |
| default?         | boolean                                           | Whether the payment source is the default payment source |
| expires_month?   | integer                                           | The year the credit card should expire in                |
| expires_year?    | integer                                           | The month the credit card should expire in               |

<RouteHeader method="DELETE" url="/users/@me/billing/payment-sources/{payment_source.id}">
  Delete Payment Source
</RouteHeader>

Deletes a payment source. Returns a 204 empty response on success. Fires [User Payment Sources Update](/topics/gateway-events#user-payment-sources-update) Gateway event.

<RouteHeader method="POST" url="/users/@me/billing/payment-sources/validate-billing-address">
  Validate Billing Address
</RouteHeader>

Validates a billing address.

| Field           | Type                                              | Description                     |
| --------------- | ------------------------------------------------- | ------------------------------- |
| billing_address | [billing address](#billing-address-object) object | The billing address to validate |

###### Response Body

| Field | Type   | Description                            |
| ----- | ------ | -------------------------------------- |
| token | string | The token of validated billing address |

<RouteHeader method="POST" url="/users/@me/billing/stripe/setup-intents">
  Get Stripe Setup Intent Secret
</RouteHeader>

Creates a Stripe SetupIntent and returns client secret for it. See the [Stripe documentation](https://docs.stripe.com/api/setup_intents) for more information.

###### Response Body

| Field         | Type   | Description                       |
| ------------- | ------ | --------------------------------- |
| client_secret | string | The client secret of setup intent |

<RouteHeader method="GET" url="/users/@me/billing/adyen/payment-methods">
  Get Available Adyen Payment Methods
</RouteHeader>

Returns available payment methods for Adyen. This endpoint is a proxy for getting available payment methods for transactions using Adyen API. See the [Adyen documentation](https://docs.adyen.com/api-explorer/Checkout/71/post/paymentMethods) for more information.

<RouteHeader method="POST" url="/billing/apple/apply-receipt">
  Apply Apple Receipt
</RouteHeader>

| encoded_receipt    | string    |
| entitlement_sku_id | snowflake |
| presentment_amount | integer   |
| app_store_region   | string
| gift_info_options  | {reward_sku_ids?: Snowflake[]} |

<RouteHeader method="PATCH url="/billing/apple/subscriptions/{subscription.id}">
  Modify Apple Subscription
</RouteHeader>

modifies apple Subscription bruh bruh blah blah

###### JSON Params

| request_identifier | string | The ID of the request (max 128 characters) |
| operation          | string | String like 'cancel', 'resubscribe', 'reactivate' |

<RouteHeader method="POST" url="/users/@me/billing/apple/trial-offer-signature">
  Get Trial Offer Signature
</RouteHeader>

adsadasdasdasd

###### JSON Params

| product_id        | string | ??? |
| product_offer_id  | string | ??? |
| app_account_token | string | ??? |

<RouteHeader method="POST" url="/billing/apple/jwt-token">
  Get IAP JWT Request Data
</RouteHeader>

```rs
#[serde(tag = "operation", rename_all = "lowercase")]
enum Body {
  Cancel {
    request_identifier: String, // max 128
    subscription_id: Snowflake,
  },
  Charge {
    request_identifier: String, // no limit
    sku_id: Snowflake,
    currency: String, // enum
    country_code: String, // enum
  },
  Create {
    request_identifier: String, // no limit
    items: [{
      plan_id: Snowflake,
      quantity?: int, // min 1, max 500000
    }], // min 1, max 5
    currency: String, // enum
    country_code: String, // enum
  },
  Reactivate {
    request_identifier: String, // max 128
    subscription_id: Snowflake,
  },
  Resubscribe {
    request_identifier: String, // no limit
    subscription_id: Snowflake,
  },
}
// response: {"request_data": {"signatureInfo": {"token": "JWT HERE BRUH"}}}
```

POST /google-play/verify-purchase-token
```ts
type Body = {
  purchase_token: String, // max 152133
  user_id: Snowflake,
  package_name: String, // max 152133
  subscription_sku_id?: Snowflake,
  one_time_purchase_sku_id?: Snowflake,
  gift_info_options?: ???,
  one_time_purchase_options?: {consume_on_validate: bool},
}
```

Downgrade Google Play Subscription % POST /google-play/downgrade-subscription
```ts
type Body = {
  purchase_token: string,
  subscription_id: Snowflake,
  subscription_sku_id: Snowflake,
};
// idk what it responds with
```

Validate Google Play Purcahse % POST /google-play/validate-purchase
```ts
type Body = {
  product_id: string, // max 40 chars
  subscription_id?: Snowflake,
};
// responds w 204...
```