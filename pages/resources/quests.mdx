# Quests Resource

### Quest Object

Represents a sponsored quest.

###### Quest Structure

| Field            | Type                                                   | Description                                                                      |
| ---------------- | ------------------------------------------------------ | -------------------------------------------------------------------------------- |
| id               | snowflake                                              | The ID of the quest                                                              |
| config           | [quest config object](#quest-config-object)            | The configuration / metadata for the quest                                       |
| user_status      | ?[quest user status object](#quest-user-status-object) | The user's quest progress, this is null if the user hasnt accepted the quest yet |
| targeted_content | array[unknown]                                         | Unused                                                                           |
| preview          | boolean                                                | Unused                                                                           |

##### Example Quest

```json
{
  "id": "alien-quest",
  "config": {
    "quest_id": "alien-quest",
    "expires_at": "2077-01-01T11:59:59+00:00",
    "stream_duration_requirement_minutes": 30,
    "messages": {
      "quest_name": "ðŸ‘½",
      "reward_name": "Alien Cybernetics",
      "reward_name_with_article": "the Alien Cybernetics",
      "reward_redemption_instructions_by_platform": {
        "0": "To redeem, kindly beg Dolfies to give them to you ðŸ¥º"
      },
      "game_title": "Cyberalien 2077",
      "game_publisher": "Dolfies Studios"
    },
    "application_id": "yep",
    "application_name": "Cyberalien 2077",
    "get_game_link": "https://docs.discord.sex",
    "rewards_config": {
      "sku_id": "12210381551199193606",
      "tag": 3,
      "messages": {
        "name": "Cybernetic Headgear",
        "name_with_article": "a Cybernetic Headgear Decoration"
      }
    },
    "reward_code_platforms": [0],
    "reward_code_expires_at": "2077-01-01T11:59:59+00:00",
    "colors": {
      "primary": "#E944D4",
      "secondary": "#5318A7"
    },
    "assets": {
      "reward_tile": "reward.png",
      "hero": "hero.png",
      "quest_bar_hero": "quests_bar_hero.png",
      "game_tile": "game_tile.png",
      "logotype": "game_logotype.png"
    }
  },
  "user_status": {
    "user_id": "222069018507345921",
    "quest_id": "alien-quest",
    "enrolled_at": "2077-01-01T11:59:59+00:00",
    "completed_at": "2077-01-01T11:59:59+00:00",
    "claimed_at": "2077-01-01T11:59:59+00:00",
    "claimed_tier": null,
    "last_stream_heartbeat_at": "2077-01-01T11:59:59+00:00",
    "stream_progress_seconds": 1800,
    "dismissed_quest_content": 0,
    "progress": {}
  }
}
```

### Quest Config Object

Represents a quest's config data.

###### Quest Config Structure

| Field                               | Type                                                | Description                                                                                                           |
| ----------------------------------- | --------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------- |
| quest_id                            | snowflake                                           | The ID of the quest                                                                                                   |
| config_version                      | integer                                             | Quest object version, self-explanatory.                                                                               |
| expires_at                          | ISO8601 timestamp                                   | The expiry date of the quest                                                                                          |
| stream_duration_requirement_minutes | integer                                             | The streaming duration requirement for redeeming the quest's reward.                                                  |
| messages                            | [quest messages object](#quest-messages-object)     | Defines quest metadata like it's human-readable name, the game's title, publisher and reward redemtpion instructions. |
| application_id                      | snowflake                                           | The application ID of the game the quest is for                                                                       |
| application_name                    | string                                              | The name of the quest's application                                                                                   |
| get_game_link                       | string                                              | The download link for the game                                                                                        |
| rewards_config                      | [reward config object](#quest-reward-config-object) | Specifies **_Discord_** rewards for the quest, such as avatar decorations.                                            |
| reward_code_platforms               | array[[quest platform type](#quest-platform-type)]  | The platforms that the reward code can be redeemed on                                                                 |
| reward_code_expires_at              | ISO8601 timestamp                                   | The expiration date for the received redeem codes                                                                     |
| colors                              | [quest gradient object](#quest-gradient-object)     | An object that contains a primary and secondary hexadecimal color, unused in the client.                              |
| in_game_quest_config                | unknown                                             | An object that could hold configuration data for the game                                                             |
| assets                              | [quest assets object](#quest-assets-object)         | Object that holds the quest's assets                                                                                  |

##### Example Config

```json
{
  "quest_id": "fancy-quest",
  "expires_at": "2077-01-01T11:59:59+00:00",
  "stream_duration_requirement_minutes": 30,
  "messages": {
    "quest_name": "ðŸ‘½",
    "reward_name": "Alien Cybernetics",
    "reward_name_with_article": "the Alien Cybernetics",
    "reward_redemption_instructions_by_platform": {
      "0": "To redeem, kindly beg Dolfies to give them to you ðŸ¥º"
    },
    "game_title": "Cyberalien 2077",
    "game_publisher": "Dolfies Studios"
  },
  "application_id": "yep",
  "application_name": "Cyberalien 2077",
  "get_game_link": "https://docs.discord.sex",
  "rewards_config": {
    "sku_id": "12210381551199193606",
    "tag": 3,
    "messages": {
      "name": "Cybernetic Headgear",
      "name_with_article": "a Cybernetic Headgear Decoration"
    }
  },
  "reward_code_platforms": [0],
  "reward_code_expires_at": "2077-01-01T11:59:59+00:00",
  "colors": {
    "primary": "#E944D4",
    "secondary": "#5318A7"
  },
  "assets": {
    "reward_tile": "reward.png",
    "hero": "hero.png",
    "quest_bar_hero": "quests_bar_hero.png",
    "game_tile": "game_tile.png",
    "logotype": "game_logotype.png"
  },
  "video_assets": []
}
```

### Quest Platform Type

Represents the platforms that the reward code can be redeemed on.

| Value | Name           | Description                                     |
| ----- | -------------- | ----------------------------------------------- |
| 0     | Cross-Platform | The code can be redeemed on all platforms       |
| 1     | Xbox           | The code can be redeemed on Xbox                |
| 2     | PlayStation    | The code can be redeemed on PlayStation         |
| 3     | Switch         | The code can be redeemed on the Nintendo Switch |
| 4     | PC             | The code can be redeemed on PC                  |

### Quest Gradient Object

Represents a 2-point gradient with a `primary` and `secondary` color.

| Field     | Type              | Description                          |
| --------- | ----------------- | ------------------------------------ |
| primary   | hexadecimal color | The primary color of the gradient.   |
| secondary | hexadecimal color | The secondary color of the gradient. |

### Quest Messages Object

Represents quest metadata such as the quest and reward name, instructions and the game's title and publisher.

###### Quest Messages Structure

| Field                                      | Type          | Description                                                             |
| ------------------------------------------ | ------------- | ----------------------------------------------------------------------- |
| quest_name                                 | string        | The name of the quest                                                   |
| reward_name                                | string        | The name of the quest's reward.                                         |
| reward_name_with_article                   | string        | The article variant of the reward name (aka, "the Alien Cybernetics")   |
| reward_redemption_instructions_by_platform | array[string] | An array of instructions for redeeming the quest's reward per-platform. |
| game_title                                 | string        | The game's title                                                        |
| game_publisher                             | string        | The game's publisher                                                    |

### Quest User Status Object

Represents the user's quest progression

###### Quest User Status Structure

| Field                     | Type              | Description                                                                                                                     |
| ------------------------- | ----------------- | ------------------------------------------------------------------------------------------------------------------------------- |
| user_id                   | snowflake         | The user's id                                                                                                                   |
| quest_id                  | snowflake         | The quest's id                                                                                                                  |
| enrolled_at               | ISO8601 timestamp | When the user accepted the quest                                                                                                |
| completed_at              | ISO8601 timestamp | When the user completed the quest                                                                                               |
| claimed_at                | ISO8601 timestamp | When the user claimed the quest's reward                                                                                        |
| claimed_tier              | unknown           | Unused                                                                                                                          |
| last_stream_heartbeat_ack | ISO8601 timestamp | Timestamp of the latest stream heartbeat request                                                                                |
| stream_progress_seconds   | ISO8601 timestamp | The total amount of seconds the user has been streaming the game for since the quest started and before the quest was completed |
| dismissed_quest_content   | ISO8601 timestamp | Whenever the user has dismissed the quest.                                                                                      |
| progress                  | object            | Unused                                                                                                                          |

##### Example User Status

```json
{
  "user_id": "222069018507345921",
  "quest_id": "alien-quest",
  "enrolled_at": "2077-01-01T11:59:59+00:00",
  "completed_at": "2077-01-01T11:59:59+00:00",
  "claimed_at": "2077-01-01T11:59:59+00:00",
  "claimed_tier": null,
  "last_stream_heartbeat_at": "2077-01-01T11:59:59+00:00",
  "stream_progress_seconds": 1800,
  "dismissed_quest_content": 0,
  "progress": {}
}
```

### Quest Assets Object

Represents an object holding image file names, the assets can be accessed via the [quest asset endpoint](#quest-assets-endpoint)

###### Quest Assets Structure

| Field          | Type   | Description                                                                                                                                         |
| -------------- | ------ | --------------------------------------------------------------------------------------------------------------------------------------------------- |
| reward_tile    | string | An image showing a preview of the reward                                                                                                            |
| hero           | string | The quest's [hero image](https://en.wiktionary.org/wiki/hero_image), aka, fancy background                                                          |
| quest_bar_hero | string | The [hero image](https://en.wiktionary.org/wiki/hero_image) used in the quest popup that appears when launching the game before accepting the quest |
| game_tile      | string | The game's icon                                                                                                                                     |
| logotype       | string | The game's [logotype](https://en.wikipedia.org/wiki/Logo)                                                                                           |

## Example Quest Assets Object

```json
{
  "reward_tile": "reward.png",
  "hero": "hero.png",
  "quest_bar_hero": "quests_bar_hero.png",
  "game_tile": "game_tile.png",
  "logotype": "game_logotype.png"
}
```

### Quest Reward Object

Represents an object that holds the reward code

###### Quest Reward Structure

| Field      | Type                                       | Description                                                                                                   |
| ---------- | ------------------------------------------ | ------------------------------------------------------------------------------------------------------------- |
| quest_id   | snowflake                                  | The ID of the quest                                                                                           |
| code       | string                                     | The redeem code                                                                                               |
| platform   | [platform type enum](#quest-platform-type) | The platform this redeem code applies to                                                                      |
| user_id    | snowflake                                  | The ID of the user who this code belongs to                                                                   |
| claimed_at | ISO8601 timestamp                          | When the user claimed the quest's reward                                                                      |
| tier       | unknown                                    | Unused - possibly the same as the `claimed_tier` field in the [user status object](#quest-user-status-object) |

#### Example Quest Reward Object

```json
{
  "quest_id": "alien-quest",
  "code": "dolfies-pls-give-me-the-alien-tech-ðŸ¥º",
  "platform": 0,
  "user_id": "222069018507345921",
  "claimed_at": "2077-01-01T18:41:29.706194+00:00",
  "tier": null
}
```

### Quest Reward Config Object

Represents an object that holds Discord-specific awards for the quest, such as avatar decorations.

###### Quest Reward Config Structure

| Field             | Type                                                   | Description                                                               |
| ----------------- | ------------------------------------------------------ | ------------------------------------------------------------------------- |
| assignment_method | integer                                                | Unknown integer that controls something related to reward assignment      |
| rewards           | array[[discord reward object](#discord-reward-object)] | Specifies which rewards should the user receive upon completing the quest |

#### Example Reward Config Object

```json
{
  "assignment_method": 1,
  "rewards": [
    {
      "sku_id": "12210381551199193606",
      "tag": 3,
      "messages": {
        "name": "Cybernetic Headgear",
        "name_with_article": "a Cybernetic Headgear Decoration"
      }
    }
  ]
}
```

### Discord Reward Object

Represents a quest's Discord item reward, such as avatar decorations.

###### Discord Reward Config Structure

| Field    | Type                                                                    | Description                                                                              |
| -------- | ----------------------------------------------------------------------- | ---------------------------------------------------------------------------------------- |
| sku_id   | snowflake                                                               | Snowflake that specifies the store item to award upon the quest's completion.            |
| tag      | integer                                                                 | Unknown integer                                                                          |
| messages | [quest discord reward messages object](#discord-reward-messages-object) | Defines quest metadata like it's human-readable name and an article version of the name. |

#### Example Discord Reward Object

```json
{
  "sku_id": "12210381551199193606",
  "tag": 3,
  "messages": {
    "name": "Cybernetic Headgear",
    "name_with_article": "a Cybernetic Headgear Decoration"
  }
}
```

### Discord Reward Messages Object

Represents metadata about a store item reward, like it's name and an article variant of its name

###### Discord Reward Config Structure

| Field             | Type   | Description                                                            |
| ----------------- | ------ | ---------------------------------------------------------------------- |
| name              | string | The reward's name                                                      |
| name_with_article | string | The article variant of the name (ex. a Cybernetic Headgear Decoration) |

#### Example Discord Reward Object

```json
{
  "name": "Cybernetic Headgear",
  "name_with_article": "a Cybernetic Headgear Decoration"
}
```

## Endpoints

<RouteHeader method="GET" url="/quests/@me">
  Get Available Quests
</RouteHeader>

Returns a list of all available [quests](#quest-object)

##### Example Response

```json
{
  "quests": [
    {
      "id": "alien-quest",
      "config": {
        "quest_id": "alien-quest",
        "expires_at": "2077-01-01T11:59:59+00:00",
        "stream_duration_requirement_minutes": 30,
        "messages": {
          "quest_name": "ðŸ‘½",
          "reward_name": "Alien Cybernetics",
          "reward_name_with_article": "the Alien Cybernetics",
          "reward_redemption_instructions_by_platform": {
            "0": "To redeem, kindly beg Dolfies to give them to you ðŸ¥º"
          },
          "game_title": "Cyberalien 2077",
          "game_publisher": "Dolfies Studios"
        },
        "application_id": "yep",
        "application_name": "Cyberalien 2077",
        "get_game_link": "https://docs.discord.sex",
        "reward_code_platforms": [0],
        "reward_code_expires_at": "2077-01-01T11:59:59+00:00",
        "colors": {
          "primary": "#E944D4",
          "secondary": "#5318A7"
        },
        "assets": {
          "reward_tile": "reward.png",
          "hero": "hero.png",
          "quest_bar_hero": "quests_bar_hero.png",
          "game_tile": "game_tile.png",
          "logotype": "game_logotype.png"
        }
      },
      "user_status": {
        "user_id": "222069018507345921",
        "quest_id": "alien-quest",
        "enrolled_at": "2077-01-01T11:59:59+00:00",
        "completed_at": "2077-01-01T11:59:59+00:00",
        "claimed_at": "2077-01-01T11:59:59+00:00",
        "claimed_tier": null,
        "last_stream_heartbeat_at": "2077-01-01T11:59:59+00:00",
        "stream_progress_seconds": 1800,
        "dismissed_quest_content": 0,
        "progress": {}
      }
    }
  ]
}
```

<RouteHeader method="POST" url="/quests/{quest.id}/enroll">
  Enroll Into A Quest
</RouteHeader>

Enrolls into/accepts a [quest](#quest-object) and returns a [quest user status object.](#quest-user-status-object)

##### Example Response

```json
{
  "user_id": "222069018507345921",
  "quest_id": "alien-quest",
  "enrolled_at": "2077-01-01T11:59:59+00:00",
  "completed_at": null,
  "claimed_at": null,
  "claimed_tier": null,
  "last_stream_heartbeat_at": null,
  "stream_progress_seconds": 0,
  "dismissed_quest_content": 0,
  "progress": {}
}
```

##### Example Response

<RouteHeader method="POST" url="/quests/{quest.id}/claim-reward">
  Claim A Quest's Reward
</RouteHeader>

Claims the quest's reward and sets both the `completed_at` and the `claimed_at` fields of the [User Status Object](#quest-user-status-object) to the current timestamp.

Note that this endpoint _requires_ a valid captcha key.

##### Example Response (Avatar Decorations)

```json
{
  "claimed_at": "2024-04-17T23:30:41.000321+00:00",
  "entitlements": [
    {
      "id": "1230299425620885624",
      "sku_id": "1226939756617793606",
      "application_id": "1096190356233670716",
      "user_id": "1076968000755859456",
      "deleted": false,
      "type": 10,
      "tenant_metadata": {},
      "gift_code_flags": 0,
      "promotion_id": null
    }
  ],
  "errors": []
}
```

<RouteHeader method="POST" url="/quests/{quest.id}/reward-code">
  Fetch The Received Reward Code
</RouteHeader>

Retrieves the reward code for the specified [platform.](#quest-platform-type)

###### JSON Params

| Field    | Type                                       | Description                             |
| -------- | ------------------------------------------ | --------------------------------------- |
| location | integer                                    | Used for analytics (probably)           |
| platform | [platform type enum](#quest-platform-type) | Which platform to retrieve the code for |

#### Example Response

```json
{
  "quest_id": "alien-quest",
  "code": "dolfies-pls-give-me-the-alien-tech-ðŸ¥º",
  "platform": 0,
  "user_id": "222069018507345921",
  "claimed_at": "2077-01-01T18:41:29.706194+00:00",
  "tier": null
}
```

<RouteHeader method="POST" url="/quests/{quest.id}/reward-code">
  Send Stream Heartbeat
</RouteHeader>

Tells the server to update the `last_stream_heartbeat` and `stream_progress_seconds` fields, and is used for keeping track of how long the stream has been running for and for checking if the user has met the stream duration requirement.
Returns a [quest user status object.](#quest-user-status-object)

###### JSON Params

| Field      | Type   | Description                                                                                                                                                   |
| ---------- | ------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| stream_key | string | A string that is a combination of the guild id, the voice channel id and the user's id. ex. `guild:169256939211980800:1050497861969793164:852892297661906993` |

#### Example Response

```json
{
  "user_id": "222069018507345921",
  "quest_id": "alien-quest",
  "enrolled_at": "2077-01-01T11:59:59+00:00",
  "last_stream_heartbeat": "2077-01-01T23:03:22.850655+00:00",
  "completed_at": null,
  "claimed_at": null,
  "claimed_tier": null,
  "last_stream_heartbeat_at": null,
  "stream_progress_seconds": 741,
  "dismissed_quest_content": 0,
  "progress": {}
}
```
